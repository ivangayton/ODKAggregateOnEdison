#!/bin/bash

apt-get update
apt-get upgrade
mv /var /home/edison/
ln -s /home/edison/var/ /var
apt-get install -y openjdk-7-jdk
apt-get install -y tomcat7 tomcat7-admin

# Add a few lines to the tomcat-users file. Because the addtions need
# to go before the end of the file, we're creating a temporary file with
# all but the last line of the tomcat-users file, adding the appropriate
# lines and reinstating the end tag, then overwriting the original with
# the resulting temp file. 
# TODO: If this script is run again, it will add another
# end tag as well as adding the user again, which is not good. It probably
# makes more sense to simply overwrite the tomcat-users file with a complete
# good one.
head -n -1 /etc/tomcat7/tomcat-users.xml > /etc/tomcat7/tomcat-users.xml.tmp
echo '  <role rolename="manager-gui"/>
  <role rolename="admin"/>
  <user username="admin" password="admin" roles="admin,manager-gui"/>
</tomcat-users>' >> /etc/tomcat7/tomcat-users.xml.tmp
mv /etc/tomcat7/tomcat-users.xml.tmp /etc/tomcat7/tomcat-users.xml

echo deb http://apt.postgresql.org/pub/repos/apt/ wheezy-pgdg main >> /etc/apt/sources.list.d/pgdg.list
apt-get install wget ca-certificates
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add -
apt-get update
apt-get install postgresql-9.4 postgresql-client

# now run a script within postgresql as user postgres
# don't know how to do that yet

